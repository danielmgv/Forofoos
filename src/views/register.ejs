<link rel="stylesheet" href="/styles.css" />

<div class="auth-container">
  <h2>Crear cuenta</h2>
  <% if (typeof error !== 'undefined' && error) { %>
  <div id="serverError" class="alert"><%= error %></div>
  <% } %>

  <div id="formError" class="alert hidden"></div>

  <form id="registerForm" action="/auth/register" method="POST" novalidate>
    <input class="input" id="username" type="text" name="username" placeholder="Usuario" required />
    <input
      class="input"
      id="email"
      type="email"
      name="email"
      placeholder="Email"
      required
      pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
      title="Introduce un email v치lido"
    />
    <input
      class="input"
      id="password"
      type="password"
      name="password"
      placeholder="Contrase침a"
      required
      minlength="8"
    />
    <button class="btn-primary" type="submit">Crear Cuenta</button>
  </form>
</div>

<script>
  (function () {
    const form = document.getElementById('registerForm');
    const formError = document.getElementById('formError');
    const serverError = document.getElementById('serverError');
    if (serverError) {
      serverError.style.display = 'block';
    }

    form.addEventListener('submit', function (e) {
      formError.style.display = 'none';
      formError.textContent = '';
      const username = form.username.value.trim();
      const email = form.email.value.trim();
      const password = form.password.value;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!username) {
        e.preventDefault();
        formError.textContent = 'El usuario es obligatorio';
        formError.style.display = 'block';
        form.username.focus();
        return;
      }

      if (!emailRegex.test(email)) {
        e.preventDefault();
        formError.textContent = 'El email no tiene un formato v치lido';
        formError.style.display = 'block';
        form.email.focus();
        return;
      }

      if (password.length < 8) {
        e.preventDefault();
        formError.textContent = 'La contrase침a debe tener al menos 8 caracteres';
        formError.style.display = 'block';
        form.password.focus();
        return;
      }
    });

    form.querySelectorAll('input').forEach((inp) =>
      inp.addEventListener('input', () => {
        formError.style.display = 'none';
        formError.textContent = '';
      })
    );
  })();
</script>
