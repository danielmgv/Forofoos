<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - ForoFoos</title>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="container">
    <nav>
      <ul>
        <li><strong>ForoFoos</strong></li>
      </ul>
      <ul>
        <li><a href="/dashboard" class="secondary" aria-current="page">Dashboard</a></li>
        <li><a href="/proyectos">Proyectos</a></li>
        <li><a href="/configuracion">Configuración</a></li>
        <li><a href="/logout">Cerrar Sesión (<%= user.name %>)</a></li>
      </ul>
    </nav>

    <main>
      <hgroup>
        <h1>Dashboard</h1>
        <h2>Bienvenido, <%= user.name %></h2>
      </hgroup>

      <div class="grid">
        <article>
          <header>Resumen General</header>
          <h3>Total de Proyectos</h3>
          <p style="font-size: 3rem; font-weight: bold; margin-bottom: 1rem;"><%= totalProjects %></p>
          
          <% if (lastProject) { %>
            <h3>Última Actualización</h3>
            <p>
              <strong><%= lastProject.nombre %></strong><br>
              <small><%= new Date(lastProject.updated_at).toLocaleDateString('es-ES') %></small>
            </p>
          <% } %>
          <footer>
            <a href="/proyectos" role="button" class="outline">Gestionar Proyectos</a>
          </footer>
        </article>

        <article>
          <header>Estadísticas de Estado</header>
          <div style="max-width: 400px; margin: 0 auto;">
            <canvas id="projectsChart"></canvas>
          </div>
        </article>
      </div>

    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const ctx = document.getElementById('projectsChart').getContext('2d');
      const chartData = <%- JSON.stringify(chartData) %>; // Inyectar datos desde el servidor

      if (chartData.labels.length > 0) {
        new Chart(ctx, {
          type: 'doughnut', // o 'pie', 'bar'
          data: {
            labels: chartData.labels,
            datasets: [{
              label: 'Proyectos por Estado',
              data: chartData.data,
              backgroundColor: [
                'rgba(255, 159, 64, 0.7)', // En progreso
                'rgba(75, 192, 192, 0.7)',  // Completado
                'rgba(255, 205, 86, 0.7)',  // En espera
                'rgba(255, 99, 132, 0.7)',   // Cancelado
                'rgba(54, 162, 235, 0.7)'    // Otro estado
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      } else {
        const container = document.querySelector('.chart-container');
        container.innerHTML = '<article><p>No tienes proyectos para mostrar estadísticas. ¡Crea uno en la sección de Proyectos!</p></article>';
      }
    });
  </script>

</body>
</html>