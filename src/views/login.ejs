<link rel="stylesheet" href="/styles.css" />

<div class="auth-container">
  <h2>SoPro, La Plataforma para dar vida a proyectos sociales</h2>

  <% if (typeof error !== 'undefined' && error) { %>
  <div id="serverError" class="alert"><%= error %></div>
  <% } %>

  <div id="formError" class="alert hidden"></div>

  <form id="loginForm" action="/login" method="POST" novalidate>
    <input
      class="input"
      id="email"
      type="email"
      name="email"
      placeholder="Correo electrónico"
      required
      pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
      title="Introduce un email válido"
    />
    <input
      class="input"
      id="password"
      type="password"
      name="password"
      placeholder="Contraseña"
      required
    />
    <button class="btn-primary" type="submit">Entrar</button>
  </form>
  <p class="footer-note">
    ¿No tienes cuenta? <a href="/register" class="link-primary">Regístrate</a>
  </p>
</div>

<script>
  (function () {
    const form = document.getElementById('loginForm');
    const formError = document.getElementById('formError');
    const serverError = document.getElementById('serverError');
    if (serverError) {
      serverError.style.display = 'block';
    }

    form.addEventListener('submit', function (e) {
      formError.style.display = 'none';
      formError.textContent = '';
      const email = form.email.value.trim();
      const password = form.password.value;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!emailRegex.test(email)) {
        e.preventDefault();
        formError.textContent = 'El email no tiene un formato válido';
        formError.style.display = 'block';
        form.email.focus();
        return;
      }

      if (!password) {
        e.preventDefault();
        formError.textContent = 'La contraseña es obligatoria';
        formError.style.display = 'block';
        form.password.focus();
        return;
      }
    });

    form.querySelectorAll('input').forEach((inp) =>
      inp.addEventListener('input', () => {
        formError.style.display = 'none';
        formError.textContent = '';
      })
    );
  })();
</script>
